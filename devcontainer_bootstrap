#!/bin/bash
# Dev Container Bootstrap Script f√ºr HAminiEMS

set -e

echo "üöÄ HAminiEMS Dev Container wird initialisiert..."

# Pr√ºfe ob Home Assistant Supervisor l√§uft
if ! command -v ha &> /dev/null; then
    echo "‚ö†Ô∏è  Home Assistant Supervisor CLI nicht gefunden"
    echo "   Das ist normal, wenn der Container au√üerhalb von Home Assistant l√§uft"
else
    echo "‚úÖ Home Assistant Supervisor CLI gefunden"
    
    # Pr√ºfe ob das Add-On bereits registriert ist
    if ha addons info "local_haminiems" &> /dev/null; then
        echo "‚úÖ Add-On 'local_haminiems' ist bereits registriert"
    else
        echo "üì¶ Registriere Add-On 'local_haminiems'..."
        ha addons reload
        sleep 2
    fi
fi

# Python Dependencies pr√ºfen
if command -v python3 &> /dev/null; then
    echo "‚úÖ Python 3 gefunden: $(python3 --version)"
    
    # Pr√ºfe ob Flask installiert ist
    if python3 -c "import flask" &> /dev/null; then
        echo "‚úÖ Flask ist installiert"
    else
        echo "‚ö†Ô∏è  Flask nicht gefunden (wird im Container installiert)"
    fi
else
    echo "‚ö†Ô∏è  Python 3 nicht gefunden"
fi

echo ""
echo "‚ú® Dev Container ist bereit!"
echo ""
echo "N√ºtzliche Befehle:"
echo "  - ha addons rebuild local_haminiems  # Add-On neu bauen"
echo "  - ha addons start local_haminiems     # Add-On starten"
echo "  - ha addons logs local_haminiems      # Logs anzeigen"
echo ""

